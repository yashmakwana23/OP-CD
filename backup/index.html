<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>One Piece Episode Countdown - Final</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Poppins:wght@400;700;900&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="style.css">

</head>
<body>
    <div class="quiz-container">

        <!-- Background Layer -->
        <div class="background-layer">
            <img src="images/perspective-grid-bg.png" alt="Background Grid" class="background-img">
            <div class="overlay"></div>
        </div>

        <!-- Decorative Elements Layer -->
        <div class="decor-layer">
             <img src="images/decor-squiggle-pink.png" class="decor-item decor-squiggle" alt="">
             <img src="images/decor-arrow-black.png" class="decor-item decor-arrow" alt="">
             <img src="images/decor-star-yellow.png" class="decor-item decor-star" alt="">
             <img src="images/decor-lightning-yellow.png" class="decor-item decor-lightning" alt="">
        </div>

         <!-- Logo -->
        <div class="logo-container">
            <img src="images/one-piece-logo.png" alt="One Piece Logo" class="logo-image">
        </div>

        <!-- Character Switchers -->
        <div id="left-character-switcher" class="character-switcher">
            <img id="left-char-img" src="" alt="Character">
        </div>
        <div id="right-character-switcher" class="character-switcher">
             <img id="right-char-img" src="" alt="Character">
        </div>


        <!-- Main Content Area -->
        <div class="content-layer">

            <!-- Title -->
            <div class="title-container">
                 <span class="title-its">EPISODE</span>
                 <h1 class="title-quiz-time">COUNTDOWN</h1>
                 <span class="highlight-episode-themed">1126</span> <!-- Replace -->
            </div>

            <!-- Countdown Section Area -->
            <div class="countdown-area">
                <!-- Raw Countdown -->
                <div id="raw-countdown-section" class="countdown-section raw-theme">
                    <!-- UPDATED TITLE STRUCTURE with IMG -->
                    <h2 class="countdown-title-themed raw-title">
                        <span class="countdown-logo">
                            <img src="images/logos/fuji-tv.png" alt="Fuji TV"> <!-- Actual Logo -->
                        </span>
                        <span class="countdown-main-title">Fuji TV</span>
                        <span class="countdown-sub-title">9:30 AM JST | Raw Episode</span>
                    </h2>
                    <div class="countdown-boxes" id="raw-countdown-box">
                        <!-- JS Populates -->
                    </div>
                </div>
                <!-- Sub Countdown -->
                <div id="sub-countdown-section" class="countdown-section sub-theme">
                     <!-- UPDATED TITLE STRUCTURE with IMG -->
                     <h2 class="countdown-title-themed sub-title">
                        <span class="countdown-logo">
                             <img src="images/logos/crunchyroll.png" alt="Crunchyroll"> <!-- Actual Logo -->
                        </span>
                        <span class="countdown-main-title">Crunchyroll</span>
                        <span class="countdown-sub-title">~11:00 AM JST | English Sub</span>
                    </h2>
                    <div class="countdown-boxes" id="sub-countdown-box">
                         <!-- JS Populates -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Crew Image Layer -->
        <div class="crew-image-container">
             <img src="images/one-piece-crew.png" alt="Crew Image" class="crew-image">
        </div>

        <!-- Fullscreen Button -->
        <button class="fullscreen-button" id="fullscreen-btn">FS</button>

        <!-- Bottom Discord Message Bar -->
         <div id="bottom-discord-message" class="bottom-discord-bar">
              <span>Join Discord (Type !dc in chat) ðŸ‘‰ <a href="https://discord.gg/YOUR_SERVER" target="_blank">Click Here</a></span>
         </div>

         <!-- Discord Overlay (Initially Hidden) -->
         <div id="discord-overlay">
             <div class="overlay-content">
                 <h2 class="overlay-title">Episodes Are Out!</h2>
                 <p>Join the Discord server! Type <span class="highlight-command">!dc</span> in chat for the link, or click below.</p>
                 <a href="https://discord.gg/YOUR_SERVER" target="_blank" class="overlay-button">Join Discord Now!</a>
             </div>
         </div>

    </div><!-- End of quiz-container -->

    <!-- JS Section (No changes needed from previous version) -->
    <script>
        // --- Countdown Timer Setup ---
        const nowMs = new Date().getTime();
        const targetDateRaw = new Date(nowMs + 7 * 1000); // 7 seconds for testing
        const targetDateSub = new Date(nowMs + 14 * 1000); // 14 seconds for testing
        console.log("[Setup] Target Raw:", targetDateRaw.toLocaleTimeString());
        console.log("[Setup] Target Sub:", targetDateSub.toLocaleTimeString());

        // --- DOM Element References ---
        const rawCountdownSection = document.getElementById('raw-countdown-section');
        const subCountdownSection = document.getElementById('sub-countdown-section');
        const rawCountdownBox = document.getElementById("raw-countdown-box");
        const subCountdownBox = document.getElementById("sub-countdown-box");
        const bottomDiscordMessage = document.getElementById("bottom-discord-message");
        const fullscreenButton = document.getElementById("fullscreen-btn");
        const discordOverlay = document.getElementById('discord-overlay');
        const leftCharImg = document.getElementById('left-char-img');
        const rightCharImg = document.getElementById('right-char-img');

        let timeElements = { raw: {}, sub: {} };

        const initialCountdownHTML = `
            <div class="box"><span class="number" id="{type}-days">?</span><span class="label">Days</span></div>
            <div class="box"><span class="number" id="{type}-hours">??</span><span class="label">Hours</span></div>
            <div class="box"><span class="number" id="{type}-minutes">??</span><span class="label">Mins</span></div>
            <div class="box"><span class="number" id="{type}-seconds">??</span><span class="label">Secs</span></div>`;

        let countdownInterval = null;
        let currentState = 0;

        // --- Character Switcher Setup ---
        const characterImages = [
            "images/chars/luffy.png", "images/chars/zoro.png",
            "images/chars/nami.png", "images/chars/sanji.png",
            "images/chars/chopper.png", "images/chars/robin.png",
            "images/chars/franky.png", "images/chars/brook.png",
            "images/chars/jinbei.png",
            "images/chars/akainu.png",
            "images/chars/law.png",
        ];
        let leftCharIndex = -1;
        let rightCharIndex = Math.floor(characterImages.length / 2) -1;
        let leftInterval, rightInterval;
        const switchIntervalTime = 7000;

        function swapCharacter(side) {
            const imgElement = (side === 'left') ? leftCharImg : rightCharImg;
            if (!imgElement) return; // Exit if element not found

            let currentIndex = (side === 'left') ? leftCharIndex : rightCharIndex;
            let otherIndex = (side === 'left') ? rightCharIndex : leftCharIndex;
            let attempts = 0;
            do {
                currentIndex = (currentIndex + 1) % characterImages.length;
                attempts++;
            } while (characterImages.length > 1 && currentIndex === otherIndex && attempts < characterImages.length)

            const nextImageSrc = characterImages[currentIndex];

            imgElement.classList.remove('visible');

            setTimeout(() => {
                imgElement.src = nextImageSrc;
                imgElement.alt = nextImageSrc.split('/').pop().split('.')[0];
                 imgElement.onload = () => {
                     imgElement.classList.add('visible');
                     if (side === 'left') { leftCharIndex = currentIndex; }
                     else { rightCharIndex = currentIndex; }
                 };
                 imgElement.onerror = () => { console.error(`Error loading image for ${side}: ${nextImageSrc}`); }
                 if (!imgElement.classList.contains('visible') && imgElement.complete) {
                    imgElement.classList.add('visible');
                 }
            }, 500);
        }

        function startCharacterSwitcher() {
             if (characterImages.length === 0 || !leftCharImg || !rightCharImg) {
                console.warn("Character switcher cannot start: No images or elements missing.");
                return;
            }
             swapCharacter('left');
             setTimeout(() => swapCharacter('right'), 1000);

             leftInterval = setInterval(() => swapCharacter('left'), switchIntervalTime);
             rightInterval = setInterval(() => swapCharacter('right'), switchIntervalTime);
             console.log("Character Switcher Started");
        }
        // --- End Character Switcher Setup ---

        // --- Helper Function to Update Time Elements ---
        function updateTimeElements(elements, distance) {
            if (!elements || !elements.days || !elements.hours || !elements.minutes || !elements.seconds) return;
            if (distance > 0) {
                elements.days.textContent = Math.floor(distance / (1000 * 60 * 60 * 24));
                elements.hours.textContent = String(Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60))).padStart(2,'0');
                elements.minutes.textContent = String(Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60))).padStart(2,'0');
                elements.seconds.textContent = String(Math.floor((distance % (1000 * 60)) / 1000)).padStart(2,'0');
            } else {
                elements.days.textContent = '0'; elements.hours.textContent = '00';
                elements.minutes.textContent = '00'; elements.seconds.textContent = '00';
            }
        }

        // --- Live Message Templates ---
        function createLiveMessage(type) {
            const isRaw = type === 'raw';
            const title = isRaw ? "RAW IS LIVE!" : "SUB IS LIVE!";
            const messageClass = "live-message-themed";
            return `<div class="${messageClass}">ðŸŽ‰ ${title} ðŸŽ‰ Check Discord!</div>`;
        }

        // --- Main Countdown Logic ---
        function updateCountdown() {
            const currentTime = new Date().getTime();
            const distanceRaw = targetDateRaw - currentTime;
            const distanceSub = targetDateSub - currentTime;
            const rawIsLive = distanceRaw <= 0;
            const subIsLive = distanceSub <= 0;

            let nextState = 0;
            if (!rawIsLive && !subIsLive) nextState = 1;
            else if (rawIsLive && !subIsLive) nextState = 2;
            else if (rawIsLive && subIsLive) nextState = 3;

            if (nextState !== currentState) {
                console.log(`State Change: ${currentState} -> ${nextState}`);
                rawCountdownSection.classList.remove('primary-focus', 'secondary-focus', 'countdown-finished');
                subCountdownSection.classList.remove('primary-focus', 'secondary-focus', 'countdown-finished');
                discordOverlay.classList.remove('show');

                if (nextState === 1) {
                    rawCountdownSection.classList.add('primary-focus');
                    subCountdownSection.classList.add('secondary-focus');
                    bottomDiscordMessage.classList.remove('highlight');
                    if (!rawCountdownBox.querySelector('.box')) rawCountdownBox.innerHTML = initialCountdownHTML.replace(/{type}/g, 'raw');
                    if (!subCountdownBox.querySelector('.box')) subCountdownBox.innerHTML = initialCountdownHTML.replace(/{type}/g, 'sub');
                    timeElements.raw = { days: document.getElementById("raw-days"), hours: document.getElementById("raw-hours"), minutes: document.getElementById("raw-minutes"), seconds: document.getElementById("raw-seconds") };
                    timeElements.sub = { days: document.getElementById("sub-days"), hours: document.getElementById("sub-hours"), minutes: document.getElementById("sub-minutes"), seconds: document.getElementById("sub-seconds") };
                } else if (nextState === 2) {
                    rawCountdownSection.classList.add('secondary-focus');
                    subCountdownSection.classList.add('primary-focus');
                    bottomDiscordMessage.classList.add('highlight');
                    if (!rawCountdownBox.querySelector('.live-message-themed')) rawCountdownBox.innerHTML = createLiveMessage('raw');
                    if (!subCountdownBox.querySelector('.box')) subCountdownBox.innerHTML = initialCountdownHTML.replace(/{type}/g, 'sub');
                     timeElements.sub = { days: document.getElementById("sub-days"), hours: document.getElementById("sub-hours"), minutes: document.getElementById("sub-minutes"), seconds: document.getElementById("sub-seconds") };
                } else if (nextState === 3) {
                    rawCountdownSection.classList.add('secondary-focus', 'countdown-finished');
                    subCountdownSection.classList.add('secondary-focus', 'countdown-finished');
                    bottomDiscordMessage.classList.add('highlight');
                    if (!rawCountdownBox.querySelector('.live-message-themed')) rawCountdownBox.innerHTML = createLiveMessage('raw');
                    if (!subCountdownBox.querySelector('.live-message-themed')) subCountdownBox.innerHTML = createLiveMessage('sub');
                    discordOverlay.classList.add('show');
                }
                currentState = nextState;
            }

            if (currentState === 1) {
                updateTimeElements(timeElements.raw, distanceRaw);
                updateTimeElements(timeElements.sub, distanceSub);
            } else if (currentState === 2) {
                updateTimeElements(timeElements.sub, distanceSub);
            }

            if (currentState === 3) {
                if (countdownInterval) { cancelAnimationFrame(countdownInterval); countdownInterval = null; console.log("Loop stopped."); }
                return;
            }
            if (countdownInterval !== null) { countdownInterval = requestAnimationFrame(updateCountdown); }
        }

        // --- Fullscreen Function ---
        function launchFullscreen() {
             if (!document.fullscreenElement && !document.mozFullScreenElement && !document.webkitFullscreenElement && !document.msFullscreenElement ) {
                 const docEl = document.documentElement;
                 if (docEl.requestFullscreen) docEl.requestFullscreen();
                 else if (docEl.msRequestFullscreen) docEl.msRequestFullscreen();
                 else if (docEl.mozRequestFullScreen) docEl.mozRequestFullScreen();
                 else if (docEl.webkitRequestFullscreen) docEl.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);
            } else {
                 if (document.exitFullscreen) document.exitFullscreen();
                 else if (document.msExitFullscreen) document.msExitFullscreen();
                 else if (document.mozCancelFullScreen) document.mozCancelFullScreen();
                 else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
            }
        }

         // --- Initial Setup & Start ---
         function initializeCountdown() {
             console.log("DOM Loaded. Initializing countdown...");
             const now = new Date().getTime();
             if (!(targetDateRaw instanceof Date) || isNaN(targetDateRaw) || !(targetDateSub instanceof Date) || isNaN(targetDateSub)) {
                 console.error("Initialization Error: Invalid target dates provided.");
                 rawCountdownBox.innerHTML = `<div class="live-message-themed error-message">Error: Invalid Date</div>`;
                 subCountdownBox.innerHTML = `<div class="live-message-themed error-message">Error: Invalid Date</div>`;
                 return;
             }
             if (!rawCountdownBox.querySelector('.box')) rawCountdownBox.innerHTML = initialCountdownHTML.replace(/{type}/g, 'raw');
             if (!subCountdownBox.querySelector('.box')) subCountdownBox.innerHTML = initialCountdownHTML.replace(/{type}/g, 'sub');
             timeElements.raw = { days: document.getElementById("raw-days"), hours: document.getElementById("raw-hours"), minutes: document.getElementById("raw-minutes"), seconds: document.getElementById("raw-seconds") };
             timeElements.sub = { days: document.getElementById("sub-days"), hours: document.getElementById("sub-hours"), minutes: document.getElementById("sub-minutes"), seconds: document.getElementById("sub-seconds") };
             if(fullscreenButton) fullscreenButton.addEventListener('click', launchFullscreen);
             console.log("Starting countdown loop...");
             currentState = 0;
             updateCountdown();
             if (currentState !== 3) { countdownInterval = requestAnimationFrame(updateCountdown); }
             setTimeout(startCharacterSwitcher, 1500);
         }
         document.addEventListener('DOMContentLoaded', initializeCountdown);
    </script>

</body>
</html>