<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>One Piece Episode Countdown - Pirate Theme</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Include Original Fonts + New Pirate Font -->
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Poppins:wght@400;700;900&family=Pirata+One&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="style.css">

</head>
<body>
    <div class="quiz-container">

        <!-- Particle Background -->
        <div id="particles-js"></div>

        <!-- Background Layer -->
        <div class="background-layer">
             <!-- Optional: Replace grid with a subtle texture like wood or ocean -->
            <!-- <img src="images/dark-wood-bg.png" alt="Background Texture" class="background-img"> -->
            <div class="overlay"></div> <!-- Keep overlay for darkening -->
        </div>

        <!-- Dropping Items Container -->
        <div id="dropping-items-container"></div>

        <!-- Decorative Elements Layer (UPDATE IMAGE PATHS!) -->
        <div class="decor-layer">
             <img src="images/decor/skull.png" class="decor-item decor-1" alt=""> <!-- Example Path -->
             <img src="images/decor/anchor.png" class="decor-item decor-2" alt=""> <!-- Example Path -->
             <img src="images/decor/crossed-swords.png" class="decor-item decor-3" alt=""> <!-- Example Path -->
             <img src="images/decor/compass-rose.png" class="decor-item decor-4" alt=""> <!-- Example Path -->
        </div>

         <!-- Logo -->
        <div class="logo-container">
            <img src="images/one-piece-logo.png" alt="One Piece Logo" class="logo-image">
        </div>

        <!-- Character Switchers -->
        <div id="left-character-switcher" class="character-switcher">
            <img id="left-char-img" src="" alt="Character">
        </div>
        <div id="right-character-switcher" class="character-switcher">
             <img id="right-char-img" src="" alt="Character">
        </div>


        <!-- Main Content Area -->
        <div class="content-layer">
           <!-- ... (Rest of the content-layer HTML remains the same) ... -->
            <div class="title-container">
                 <span class="title-its">EPISODE</span>
                 <h1 class="title-quiz-time">COUNTDOWN</h1>
                 <span class="highlight-episode-themed">1126</span> <!-- Replace -->
            </div>
            <div class="countdown-area">
                <div id="raw-countdown-section" class="countdown-section raw-theme">
                    <h2 class="countdown-title-themed raw-title">
                        <span class="countdown-logo"><img src="images/logos/fuji-tv.png" alt="Fuji TV"></span>
                        <span class="countdown-main-title">Fuji TV</span>
                        <span class="countdown-sub-title">9:30 AM JST | Raw Episode</span>
                    </h2>
                    <div class="countdown-boxes" id="raw-countdown-box"></div>
                </div>
                <div id="sub-countdown-section" class="countdown-section sub-theme">
                     <h2 class="countdown-title-themed sub-title">
                        <span class="countdown-logo"><img src="images/logos/crunchyroll.png" alt="Crunchyroll"></span>
                        <span class="countdown-main-title">Crunchyroll</span>
                        <span class="countdown-sub-title">~11:00 AM JST | English Sub</span>
                    </h2>
                    <div class="countdown-boxes" id="sub-countdown-box"></div>
                </div>
            </div>
        </div>

        <!-- Crew Image Layer -->
        <div class="crew-image-container">
             <img src="images/one-piece-crew.png" alt="Crew Image" class="crew-image">
        </div>

        <!-- Fullscreen Button -->
        <button class="fullscreen-button" id="fullscreen-btn">FS</button>

        <!-- Bottom Discord Message Bar -->
         <div id="bottom-discord-message" class="bottom-discord-bar">
              <span>Join Discord (Type !dc in chat) 👉 <a href="https://discord.gg/YOUR_SERVER" target="_blank">Click Here</a></span>
         </div>

         <!-- Discord Overlay (Initially Hidden) -->
         <div id="discord-overlay">
             <div class="overlay-content">
                 <h2 class="overlay-title">Episodes Are Out!</h2>
                 <p>Join the Discord server! Type <span class="highlight-command">!dc</span> in chat for the link, or click below.</p>
                 <a href="https://discord.gg/YOUR_SERVER" target="_blank" class="overlay-button">Join Discord Now!</a>
             </div>
         </div>

    </div><!-- End of quiz-container -->

    <!-- particles.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>

    <!-- Main JS (No changes needed from previous version) -->
    <script>
        // --- Countdown Timer Setup ---
        const nowMs = new Date().getTime();
        const targetDateRaw = new Date(nowMs + 70 * 1000); // 7 seconds
        const targetDateSub = new Date(nowMs + 140 * 1000); // 14 seconds
        console.log("[Setup] Target Raw:", targetDateRaw.toLocaleTimeString());
        console.log("[Setup] Target Sub:", targetDateSub.toLocaleTimeString());

        // --- DOM Element References ---
        const rawCountdownSection = document.getElementById('raw-countdown-section');
        const subCountdownSection = document.getElementById('sub-countdown-section');
        const rawCountdownBox = document.getElementById("raw-countdown-box");
        const subCountdownBox = document.getElementById("sub-countdown-box");
        const bottomDiscordMessage = document.getElementById("bottom-discord-message");
        const fullscreenButton = document.getElementById("fullscreen-btn");
        const discordOverlay = document.getElementById('discord-overlay');
        const leftCharImg = document.getElementById('left-char-img');
        const rightCharImg = document.getElementById('right-char-img');
        const particlesContainer = document.getElementById('particles-js');
        const droppingItemsContainer = document.getElementById('dropping-items-container');

        let timeElements = { raw: {}, sub: {} };

        const initialCountdownHTML = `
            <div class="box"><span class="number" id="{type}-days">?</span><span class="label">Days</span></div>
            <div class="box"><span class="number" id="{type}-hours">??</span><span class="label">Hours</span></div>
            <div class="box"><span class="number" id="{type}-minutes">??</span><span class="label">Mins</span></div>
            <div class="box"><span class="number" id="{type}-seconds">??</span><span class="label">Secs</span></div>`;

        let countdownInterval = null;
        let currentState = 0;

        // --- Character Switcher & Dropping Items Image Setup ---
        const characterImages = [ /* ... Keep your list ... */

        ];
        const droppingItemImages = [ /* ... Keep your list ... */
            "images/items/10325-zoro-king.png", "images/items/in1.png","images/items/in2.png",
        ];

        let leftCharIndex = -1;
        let rightCharIndex = Math.floor(characterImages.length / 2) -1;
        let leftInterval, rightInterval, dropInterval;
        const switchIntervalTime = 7000;
        const dropIntervalTime = 1500;

        // --- Functions (Keep existing: swapCharacter, startCharacterSwitcher, updateTimeElements, createLiveMessage, updateCountdown, launchFullscreen) ---
        function swapCharacter(side) { /* ... Keep existing ... */
            const imgElement = (side === 'left') ? leftCharImg : rightCharImg; if (!imgElement) return; let currentIndex = (side === 'left') ? leftCharIndex : rightCharIndex; let otherIndex = (side === 'left') ? rightCharIndex : leftCharIndex; let attempts = 0; do { currentIndex = (currentIndex + 1) % characterImages.length; attempts++; } while (characterImages.length > 1 && currentIndex === otherIndex && attempts < characterImages.length); const nextImageSrc = characterImages[currentIndex]; imgElement.classList.remove('visible'); setTimeout(() => { imgElement.src = nextImageSrc; imgElement.alt = nextImageSrc.split('/').pop().split('.')[0]; imgElement.onload = () => { imgElement.classList.add('visible'); if (side === 'left') { leftCharIndex = currentIndex; } else { rightCharIndex = currentIndex; } }; imgElement.onerror = () => { console.error(`Error loading image for ${side}: ${nextImageSrc}`); }; if (!imgElement.classList.contains('visible') && imgElement.complete) { imgElement.classList.add('visible'); } }, 500);
        }
        function startCharacterSwitcher() { /* ... Keep existing ... */
            if (characterImages.length === 0 || !leftCharImg || !rightCharImg) return; swapCharacter('left'); setTimeout(() => swapCharacter('right'), 1000); leftInterval = setInterval(() => swapCharacter('left'), switchIntervalTime); rightInterval = setInterval(() => swapCharacter('right'), switchIntervalTime); console.log("Character Switcher Started");
        }
        function updateTimeElements(elements, distance) { /* ... Keep existing ... */
            if (!elements || !elements.days || !elements.hours || !elements.minutes || !elements.seconds) return; if (distance > 0) { elements.days.textContent = Math.floor(distance / (1000 * 60 * 60 * 24)); elements.hours.textContent = String(Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60))).padStart(2,'0'); elements.minutes.textContent = String(Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60))).padStart(2,'0'); elements.seconds.textContent = String(Math.floor((distance % (1000 * 60)) / 1000)).padStart(2,'0'); } else { elements.days.textContent = '0'; elements.hours.textContent = '00'; elements.minutes.textContent = '00'; elements.seconds.textContent = '00'; }
        }
        function createLiveMessage(type) { /* ... Keep existing ... */
             const isRaw = type === 'raw'; const title = isRaw ? "RAW IS LIVE!" : "SUB IS LIVE!"; const messageClass = "live-message-themed"; return `<div class="${messageClass}">🏴‍☠️ ${title} 🏴‍☠️ Check Discord!</div>`; // Added pirate flags
        }
        function updateCountdown() { /* ... Keep existing ... */
             const currentTime = new Date().getTime(); const distanceRaw = targetDateRaw - currentTime; const distanceSub = targetDateSub - currentTime; const rawIsLive = distanceRaw <= 0; const subIsLive = distanceSub <= 0; let nextState = 0; if (!rawIsLive && !subIsLive) nextState = 1; else if (rawIsLive && !subIsLive) nextState = 2; else if (rawIsLive && subIsLive) nextState = 3; if (nextState !== currentState) { console.log(`State Change: ${currentState} -> ${nextState}`); rawCountdownSection.classList.remove('primary-focus', 'secondary-focus', 'countdown-finished'); subCountdownSection.classList.remove('primary-focus', 'secondary-focus', 'countdown-finished'); discordOverlay.classList.remove('show'); if (nextState === 1) { rawCountdownSection.classList.add('primary-focus'); subCountdownSection.classList.add('secondary-focus'); bottomDiscordMessage.classList.remove('highlight'); if (!rawCountdownBox.querySelector('.box')) rawCountdownBox.innerHTML = initialCountdownHTML.replace(/{type}/g, 'raw'); if (!subCountdownBox.querySelector('.box')) subCountdownBox.innerHTML = initialCountdownHTML.replace(/{type}/g, 'sub'); timeElements.raw = { days: document.getElementById("raw-days"), hours: document.getElementById("raw-hours"), minutes: document.getElementById("raw-minutes"), seconds: document.getElementById("raw-seconds") }; timeElements.sub = { days: document.getElementById("sub-days"), hours: document.getElementById("sub-hours"), minutes: document.getElementById("sub-minutes"), seconds: document.getElementById("sub-seconds") }; } else if (nextState === 2) { rawCountdownSection.classList.add('secondary-focus'); subCountdownSection.classList.add('primary-focus'); bottomDiscordMessage.classList.add('highlight'); if (!rawCountdownBox.querySelector('.live-message-themed')) rawCountdownBox.innerHTML = createLiveMessage('raw'); if (!subCountdownBox.querySelector('.box')) subCountdownBox.innerHTML = initialCountdownHTML.replace(/{type}/g, 'sub'); timeElements.sub = { days: document.getElementById("sub-days"), hours: document.getElementById("sub-hours"), minutes: document.getElementById("sub-minutes"), seconds: document.getElementById("sub-seconds") }; } else if (nextState === 3) { rawCountdownSection.classList.add('secondary-focus', 'countdown-finished'); subCountdownSection.classList.add('secondary-focus', 'countdown-finished'); bottomDiscordMessage.classList.add('highlight'); if (!rawCountdownBox.querySelector('.live-message-themed')) rawCountdownBox.innerHTML = createLiveMessage('raw'); if (!subCountdownBox.querySelector('.live-message-themed')) subCountdownBox.innerHTML = createLiveMessage('sub'); discordOverlay.classList.add('show'); } currentState = nextState; } if (currentState === 1) { updateTimeElements(timeElements.raw, distanceRaw); updateTimeElements(timeElements.sub, distanceSub); } else if (currentState === 2) { updateTimeElements(timeElements.sub, distanceSub); } if (currentState === 3) { if (countdownInterval) { cancelAnimationFrame(countdownInterval); countdownInterval = null; console.log("Loop stopped."); clearInterval(dropInterval); console.log("Dropping items stopped.");} return; } if (countdownInterval !== null) { countdownInterval = requestAnimationFrame(updateCountdown); }
        }
        function launchFullscreen() { /* ... Keep existing ... */
             if (!document.fullscreenElement && !document.mozFullScreenElement && !document.webkitFullscreenElement && !document.msFullscreenElement ) { const docEl = document.documentElement; if (docEl.requestFullscreen) docEl.requestFullscreen(); else if (docEl.msRequestFullscreen) docEl.msRequestFullscreen(); else if (docEl.mozRequestFullScreen) docEl.mozRequestFullScreen(); else if (docEl.webkitRequestFullscreen) docEl.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT); } else { if (document.exitFullscreen) document.exitFullscreen(); else if (document.msExitFullscreen) document.msExitFullscreen(); else if (document.mozCancelFullScreen) document.mozCancelFullScreen(); else if (document.webkitExitFullscreen) document.webkitExitFullscreen(); }
        }
        function createDroppingItem() { /* ... Keep existing ... */
            if (droppingItemImages.length === 0 || !droppingItemsContainer) return; const item = document.createElement('img'); const randomIndex = Math.floor(Math.random() * droppingItemImages.length); const randomX = Math.random() * 95; const randomDuration = Math.random() * 3 + 4; const randomDelay = Math.random() * 1; item.src = droppingItemImages[randomIndex]; item.alt = "dropping item"; item.classList.add('dropping-item'); item.style.left = `${randomX}%`; item.style.animationDuration = `${randomDuration}s`; item.style.animationDelay = `${randomDelay}s`; item.addEventListener('animationend', () => { item.remove(); }); droppingItemsContainer.appendChild(item);
        }
        function initializeCountdown() { /* ... Keep existing setup, particles init, and start logic ... */
             console.log("DOM Loaded. Initializing countdown..."); const now = new Date().getTime(); if (!(targetDateRaw instanceof Date) || isNaN(targetDateRaw) || !(targetDateSub instanceof Date) || isNaN(targetDateSub)) { console.error("Initialization Error: Invalid target dates provided."); rawCountdownBox.innerHTML = `<div class="live-message-themed error-message">Error: Invalid Date</div>`; subCountdownBox.innerHTML = `<div class="live-message-themed error-message">Error: Invalid Date</div>`; return; } if (!rawCountdownBox.querySelector('.box')) rawCountdownBox.innerHTML = initialCountdownHTML.replace(/{type}/g, 'raw'); if (!subCountdownBox.querySelector('.box')) subCountdownBox.innerHTML = initialCountdownHTML.replace(/{type}/g, 'sub'); timeElements.raw = { days: document.getElementById("raw-days"), hours: document.getElementById("raw-hours"), minutes: document.getElementById("raw-minutes"), seconds: document.getElementById("raw-seconds") }; timeElements.sub = { days: document.getElementById("sub-days"), hours: document.getElementById("sub-hours"), minutes: document.getElementById("sub-minutes"), seconds: document.getElementById("sub-seconds") }; if(fullscreenButton) fullscreenButton.addEventListener('click', launchFullscreen); if (typeof particlesJS !== 'undefined') { particlesJS('particles-js', { /* ... Keep particle config ... */ "particles": { "number": { "value": 40, "density": { "enable": true, "value_area": 800 } }, "color": { "value": "#cccccc" }, "shape": { "type": "circle" }, "opacity": { "value": 0.3, "random": true, "anim": { "enable": true, "speed": 0.4, "opacity_min": 0.1, "sync": false } }, "size": { "value": 3, "random": true, "anim": { "enable": false } }, "line_linked": { "enable": false }, "move": { "enable": true, "speed": 0.8, "direction": "bottom-left", "random": true, "straight": false, "out_mode": "out", "bounce": false, "attract": { "enable": false } } }, "interactivity": { "detect_on": "canvas", "events": { "onhover": { "enable": false }, "onclick": { "enable": false }, "resize": true } }, "retina_detect": true }); console.log("Particles Initialized."); } else { console.error("particles.js library not found."); } console.log("Starting countdown loop..."); currentState = 0; updateCountdown(); if (currentState !== 3) { countdownInterval = requestAnimationFrame(updateCountdown); } setTimeout(startCharacterSwitcher, 1500); if (droppingItemImages.length > 0) { dropInterval = setInterval(createDroppingItem, dropIntervalTime); console.log("Dropping items started."); } else { console.warn("No images defined for dropping items."); }
        }
        document.addEventListener('DOMContentLoaded', initializeCountdown);
    </script>

</body>
</html>